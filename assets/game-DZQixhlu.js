import{A as U,d as $,e as Y,S as Q,f as tt,g as et,D as V,h as it,W as st,i as ot,j as nt,c as p,V as n,k as at,M as b,O as ht,l as rt,b as ct,m as lt,E as dt,L as mt,n as ut,o as P,p as x,q as I,R as B,r as ft,s as pt,T as gt,t as R,u as bt}from"./js/vendor-three-CyrRzSLv.js";import{P as N,I as wt,c as m,s as W,u as j,a as k,l as yt,L as xt,C as Dt}from"./js/shared-DoKEvKAo.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();class vt{constructor(){this.sceneContainer=document.getElementById("scene-container"),this.lose_popup=document.getElementById("lose-popup"),this.overlay=document.getElementById("overlay"),this.loading=document.getElementById("loading"),this.loadingIcon=document.getElementById("loading-icon"),this.itemIcon=document.getElementById("item-icon"),this.pause_popup=document.getElementById("pause-popup"),this.countdownElement=document.getElementById("countdown"),this.sentenceElement=document.createElement("div"),this.sentenceElement.id="sentence-element",document.body.appendChild(this.sentenceElement);const t=document.getElementById("return-button");t&&t.addEventListener("click",this.returnToMain)}loadingScreen(){const t=["assets_/pics/GaryRound.gif","assets_/pics/JellyJump.gif","assets_/pics/SpongeBobWalk.gif","assets_/pics/PatrickRun.gif"],e=t[Math.floor(Math.random()*t.length)];this.loadingIcon.src=e,y(this.loading)}removeLoadingScreen(){w(this.loading,1,0,!0,500)}swapItem(t){this.current_item!==t&&(console.log("debuging effects. fello from ui's item ",t),this.current_item=t,this.itemIcon.src=`assets_/pics/items/${t}.png`)}lose(){y(this.overlay,0,.5,!1,500),y(this.lose_popup,0,1,!0,500)}restart(){w(this.overlay,.5,0,!0,500),w(this.lose_popup,1,0,!0,500)}pause(){console.log("pause in ui"),y(this.overlay,0,.5,!1,500),y(this.pause_popup,0,1,!0,500)}resume(){w(this.overlay,.5,0,!0,500),w(this.pause_popup,1,0,!0,500)}async countdown(t){this.countdownElement.style.display="block";for(let e=t;e>0;e--)this.countdownElement.innerText=e.toString(),await new Promise(i=>setTimeout(i,1e3));this.countdownElement.style.display="none"}returnToMain(){window.location.href="Instructions.html"}async showSentence(t,e,i=3e3){this.sentenceElement.innerText=t,this.sentenceElement.style.display="block",this.sentenceElement.style.opacity="0",this.sentenceElement.style.fontFamily="Arial, sans-serif",this.sentenceElement.style.fontWeight="bold",this.sentenceElement.style.textShadow="2px 2px 4px rgba(0, 0, 0, 0.5)",e==="title"?(this.sentenceElement.style.position="fixed",this.sentenceElement.style.top="10%",this.sentenceElement.style.left="50%",this.sentenceElement.style.transform="translateX(-50%)",this.sentenceElement.style.fontSize="5vh",this.sentenceElement.style.color="green"):e==="notice"&&(this.sentenceElement.style.position="fixed",this.sentenceElement.style.bottom="10%",this.sentenceElement.style.left="50%",this.sentenceElement.style.transform="translateX(-50%)",this.sentenceElement.style.fontSize="3vh",this.sentenceElement.style.color="red"),y(this.sentenceElement,0,1,!1,500),await new Promise(s=>setTimeout(s,i)),w(this.sentenceElement,1,0,!0,500)}}const T=document.getElementById("start-button");T&&T.addEventListener("click",()=>{T.style.display="none",Pt()});function Pt(){console.log("Game Starting..."),window.dispatchEvent(new Event("gameStart"))}function w(l,t=1,e=0,i=!0,s=500){var o=t;const a=10;var r=(t-e)*a/s,h=setInterval(function(){o<=e&&(l.style.opacity=e.toString(),l.style.filter="alpha(opacity="+e*100+")",clearInterval(h),i&&(l.style.display="none")),l.style.opacity=o.toString(),l.style.filter="alpha(opacity="+o*100+")",o-=r},a)}function y(l,t=0,e=1,i=!0,s=500){var o=t;const a=10;var r=(e-t)*a/s;i&&(l.style.display="block");var h=setInterval(function(){o>=e&&(l.style.opacity=e.toString(),l.style.filter="alpha(opacity="+e*100+")",clearInterval(h)),l.style.opacity=o.toString(),l.style.filter="alpha(opacity="+o*100+")",o+=r},a)}class g{constructor(){this.bgmAudio=null,this.collisionAudio=null,this.pickItemAudio=null,this.breakAudio=null,this.windAudio=null,this.fallAudio=null,this.squeakAudio=null,this.roboticAudio=null,this.danceAudio=null,this.warningAudio=null,this.audioLoader=new U,this.listener=new $}static getInstance(){return g.instance||(g.instance=new g),g.instance}getListener(){return this.listener}async loadAudio(t,e=!1,i=.5){const s=new Y(this.listener);try{const o=await new Promise((a,r)=>{this.audioLoader.load(t,a,void 0,r)});return s.setBuffer(o),s.setLoop(e),s.setVolume(i),s}catch(o){throw console.error(`Error loading audio from ${t}:`,o),o}}async loadAndPlayBGM(){try{this.bgmAudio||(this.bgmAudio=await this.loadAudio("assets_/audio/the-big-heist-188391.mp3",!0)),this.bgmAudio.play()}catch(t){console.error("Error loading BGM:",t)}}async playBoundingSound(){try{this.collisionAudio||(this.collisionAudio=await this.loadAudio("assets_/audio/boing-6222.mp3",!1)),this.collisionAudio.isPlaying&&this.collisionAudio.stop(),this.collisionAudio.play()}catch(t){console.error("Error playing collision sound:",t)}}async playPickItemSound(){try{this.pickItemAudio||(this.pickItemAudio=await this.loadAudio("assets_/audio/pickItem.mp3",!1)),this.pickItemAudio.isPlaying&&this.pickItemAudio.stop(),this.pickItemAudio.play()}catch(t){console.error("Error playing pickItemAudio: ",t)}}async playBreakSound(){try{this.breakAudio||(this.breakAudio=await this.loadAudio("assets_/audio/break.mp3",!1)),this.breakAudio.isPlaying&&this.breakAudio.stop(),this.breakAudio.play()}catch(t){console.error("Error playing breakAudio: ",t)}}async playWarningSound(){try{this.warningAudio||(this.warningAudio=await this.loadAudio("assets_/audio/warning.mp3",!1)),this.warningAudio.isPlaying&&this.warningAudio.stop(),this.warningAudio.play()}catch(t){console.error("Error playing warning sound:",t)}}async playWindSound(){try{this.windAudio||(this.windAudio=await this.loadAudio("assets_/audio/wind.mp3",!1)),this.windAudio.isPlaying&&this.windAudio.stop(),this.windAudio.play()}catch(t){console.error("Error playing windAudio: ",t)}}async playFallSound(){try{this.fallAudio||(this.fallAudio=await this.loadAudio("assets_/audio/fall.mp3",!1)),this.fallAudio.isPlaying&&this.fallAudio.stop(),this.fallAudio.play()}catch(t){console.error("Error playing warning sound:",t)}}async playSqueakSound(){try{this.squeakAudio||(this.squeakAudio=await this.loadAudio("assets_/audio/squeak.mp3",!1)),this.squeakAudio.isPlaying&&this.squeakAudio.stop(),this.squeakAudio.play()}catch(t){console.error("Error playing squeakAudio: ",t)}}async playRoboticSound(){try{this.roboticAudio||(this.roboticAudio=await this.loadAudio("assets_/audio/robotic.mp3",!1)),this.roboticAudio.isPlaying&&this.roboticAudio.stop(),this.roboticAudio.play()}catch(t){console.error("Error playing roboticAudio: ",t)}}async playDanceSound(){try{this.danceAudio||(this.danceAudio=await this.loadAudio("assets_/audio/dance.mp3",!1)),this.danceAudio.isPlaying&&this.danceAudio.stop(),this.danceAudio.play()}catch(t){console.error("Error playing danceAudio: ",t)}}stopBGM(){this.bgmAudio&&this.bgmAudio.stop()}pauseBGM(){this.bgmAudio&&this.bgmAudio.pause()}resumeBGM(){this.bgmAudio&&this.bgmAudio.play()}setBGMVolume(t){this.bgmAudio&&this.bgmAudio.setVolume(Math.max(0,Math.min(1,t)))}setCollisionVolume(t){this.collisionAudio&&this.collisionAudio.setVolume(Math.max(0,Math.min(1,t)))}}class Mt{constructor(){this.scene=new Q,this.scene.background=new tt(8900346),this.addLights()}addLights(){const t=new et(16777215,.5);this.scene.add(t);const e=new V(16777215,1);e.position.set(10,10,10),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.5,e.shadow.camera.far=500,e.shadow.camera.left=-50,e.shadow.camera.right=50,e.shadow.camera.top=50,e.shadow.camera.bottom=-50;const i=new it(16777215,1,100);i.position.set(5,5,5),i.castShadow=!0;const s=new V(16777215,.5);s.position.set(-10,10,-10),s.castShadow=!0}add(t){t.mesh&&(t.mesh.castShadow=!0,t.mesh.receiveShadow=!0,this.scene.add(t.mesh))}remove(t){t.mesh&&this.scene.remove(t.mesh)}getScene(){return this.scene}}class Ct{constructor(){this.renderer=new st({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=ot}get domElement(){return this.renderer.domElement}render(t,e){this.renderer.render(t.getScene(),e.camera)}}class M{constructor(t,e,i){this.boundingBoxHelper=null,this.type=t,this.name=e,this.mesh=new ht,this.mesh.add(i),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,new p().setFromObject(this.mesh).getSize(new n),this.boundingBoxHelper=new rt(this.mesh,16711680)}destruct(t=null){var e,i;if(t&&(this.type==="item"||this.type==="obstacle")){console.log(this.name,"is destructing");const s=new N;s.createBreakEffect(this.getCenter()),t.add(s.particles),s.addToUpdateList(t)}(e=this.mesh.parent)==null||e.remove(this.mesh),(i=this.boundingBoxHelper.parent)==null||i.remove(this.boundingBoxHelper),F(this.mesh)}rescale(t,e,i){this.mesh.scale.set(1,1,1);const s=new p().setFromObject(this.mesh),o=s.getSize(new n),a=s.getCenter(new n);new n(a.x,s.min.y,a.z);const r=t/o.x,h=e/o.y,c=i/o.z;this.mesh.scale.set(r,h,c),this.updateBoundingBox()}updateBoundingBox(){this.boundingBoxHelper&&this.boundingBoxHelper.update()}addBoundingBoxHelper(t){t.add(this.boundingBoxHelper)}addBoundingBoxHelperToThis(){this.mesh.add(this.boundingBoxHelper)}getCenter(){return new p().setFromObject(this.mesh).getCenter(new n)}getBottomCenter(){const t=new p().setFromObject(this.mesh),e=t.getCenter(new n);return new n(e.x,t.min.y,e.z)}getTopCenter(){const t=new p().setFromObject(this.mesh),e=t.getCenter(new n);return new n(e.x,t.max.y,e.z)}setPosition(t,e,i){const s=new p().setFromObject(this.mesh);s.getSize(new n);const o=s.getCenter(new n),a=new n(o.x,s.min.y,o.z),r=new n(t,e,i).sub(a);this.mesh.position.add(r),this.updateBoundingBox(),console.log(this.name,o,a,r)}rotate(t,e){this.mesh.rotation[t]+=e,this.updateBoundingBox()}setRotation(t,e,i){this.mesh.rotation.set(t,e,i),this.updateBoundingBox()}lookAt(t,e,i){this.mesh.lookAt(new n(t,e,i)),this.updateBoundingBox()}setEulerRotation(t,e,i,s="XYZ"){this.mesh.rotation.set(t,e,i,s),this.updateBoundingBox()}rotateOnAxis(t,e){this.mesh.rotateOnAxis(t.normalize(),e),this.updateBoundingBox()}}class C extends M{constructor(t,e,i){super(t,e,i.scene),this.mixer=null,this.animations=[],this.gltf=i,this.initAnimation()}initAnimation(t=0){console.log(this.name,"is initializing animation",t),this.gltf.animations&&this.gltf.animations.length>t?(console.log(this.name,"has animations"),this.mixer=new nt(this.mesh),this.animations=this.gltf.animations,this.mixer.clipAction(this.animations[t]).play(),console.log(this.name,this.animations,this.mixer)):console.log(this.name,"has no animations")}changeGLTF(t,e=0){const i=new p().setFromObject(this.mesh);i.getSize(new n);const s=i.getCenter(new n),o=new n(s.x,i.min.y,s.z);this.mesh.children.forEach(r=>{r instanceof at||this.mesh.remove(r)}),F(this.mesh),this.mesh.add(t.scene),this.rescale(1,1,1),this.mixer=null,this.animations=[],this.gltf=t,this.setPosition(o.x,o.y,o.z),this.initAnimation(e),console.log(this.name,"is changed to",t)}animate(t){this.mixer&&this.mixer.update(t)}}function F(l){if(l instanceof b&&(l.geometry.dispose(),Array.isArray(l.material)?l.material.forEach(t=>t.dispose()):l.material&&l.material.dispose()),l.children)for(let t of l.children)F(t)}class zt{}class St extends zt{constructor(t,e=window.innerWidth/window.innerHeight,i=75,s=1e3){super(),this.cameraDistance=4,this.cameraAngle=ct.degToRad(20),this._isCustomCamera=!0,this.isShaking=!1,this.isClosingup=!1,this._camera=new lt(i,e,.1,s),this.character=t,this.thirdPersonPerspective()}get camera(){return this._camera}thirdPersonPerspective(){let t=this.character.mesh.position.x,e=this.character.mesh.position.y+this.cameraDistance,i=this.character.mesh.position.z-this.cameraDistance;this._camera.position.set(t,e,i),this._camera.lookAt(new n(this.character.mesh.position.x,this.character.mesh.position.y,this.character.mesh.position.z+this.cameraDistance)),this._camera.up.set(0,1,0),this.perspective="thirdPerson"}firstPersonPerspective(){let t=this.character.mesh.position.x,e=this.character.mesh.position.y+this.cameraDistance,i=this.character.mesh.position.z;this._camera.position.set(t,e,i),this._camera.lookAt(new n(this.character.mesh.position.x,this.character.mesh.position.y,this.character.mesh.position.z+this.cameraDistance)),this._camera.up.set(0,1,0),this.perspective="firstPerson"}secondPersonPerspective(){let t=this.character.mesh.position.x+this.cameraDistance,e=this.character.mesh.position.y+this.cameraDistance,i=this.character.mesh.position.z+this.cameraDistance;this._camera.position.set(t,e,i),this._camera.lookAt(this.character.mesh.position),this._camera.up.set(0,1,0),this.perspective="secondPerson"}async closeUp(){this.isClosingup=!0;const t=this._camera.position.clone(),e=this._camera.fov,i=new n(this.character.mesh.position.x,this.character.mesh.position.y+2,this.character.mesh.position.z+3.5);await this.animateCameraPositionAndFov(i,50,200),await new Promise(s=>setTimeout(s,1e3)),await this.animateCameraPositionAndFov(t,e,200),this.isClosingup=!1}animateCameraPositionAndFov(t,e,i){return new Promise(s=>{const o=this._camera.position.clone(),a=this._camera.fov,r=performance.now(),h=c=>{const d=c-r,u=Math.min(d/i,1);this._camera.position.lerpVectors(o,t,u),this._camera.fov=a+(e-a)*u,this._camera.updateProjectionMatrix(),this._camera.lookAt(this.character.mesh.position),u<1?requestAnimationFrame(h):s()};requestAnimationFrame(h)})}update(){if(!(this.isShaking||this.isClosingup))switch(this.perspective){case"thirdPerson":this.thirdPersonPerspective();break;case"firstPerson":this.firstPersonPerspective();break;case"secondPerson":this.secondPersonPerspective();break;default:this.thirdPersonPerspective();break}}shake(t,e){this.isShaking=!0;const i=this._camera.position.clone(),s=setInterval(()=>{this._camera.position.x=i.x+(Math.random()-.5)*t,this._camera.position.y=i.y+(Math.random()-.5)*t,this._camera.position.z=i.z+(Math.random()-.5)*t},1e3/60);setTimeout(()=>{clearInterval(s),this._camera.position.copy(i),this.isShaking=!1},e)}}class X extends C{constructor(t,e){super("character",t,e),this.waiting_effect=["",{duration:0,apply:i=>{},remove:i=>{}}],this.effects={},this.movableBoundary={forward:1e4,backward:-1e3,left:-1e3,right:1e3,up:1e3,down:0},this.condition="normal",this.movementUpdated=!1,this.punchingTime=0,this.delta=.15,this.defaultMaxVel=3.5,this.defaultMinVel=.1,this.defaultMaxJumpVel=4.5,this.defaultDeaccel=5,this.defaultAccelZ=4,this.defaultAccelX=4,this.defaultVelX=3,this.defaultGravity=8,this.rescale(1,1,1),this.camera=new St(this)}init(){this.pos=new n(0,0,0),this.vel=new n(0,0,0),this.accel=new n(0,0,0),this.force=new n(0,0,0),this.inputHandler=new wt,this.condition="normal",this.newMovement="idle",this.updateCondition(this.condition),this.updateMovement()}onGround(){const t=new p().setFromObject(this.mesh);return Math.abs(this.movableBoundary.down-t.min.y)<this.delta}updateMovementTmp(t){this.newMovement=t}updateAcceleration(t){this.condition=="confusion"?(this.inputHandler.isKeyPressed("s")?this.accel.z=this.defaultAccelZ:this.inputHandler.isKeyPressed("w")?this.accel.z=-this.defaultAccelZ/2:Math.abs(this.vel.z)<this.defaultMinVel?(this.accel.z=0,this.vel.z=0):this.vel.z>0?this.accel.z=-this.defaultDeaccel:this.accel.z=this.defaultDeaccel,this.inputHandler.isKeyPressed("d")?(this.vel.x=this.defaultVelX,this.force.x<0&&(this.vel.x=this.defaultVelX/2),this.accel.x+=this.force.x):this.inputHandler.isKeyPressed("a")?(this.vel.x=-this.defaultVelX,this.force.x>0&&(this.vel.x=-this.defaultVelX/2),this.accel.x+=this.force.x):Math.abs(this.vel.x)<this.defaultMinVel&&this.force.x==0?(this.accel.x=0,this.vel.x=0):this.vel.x>0&&this.force.x==0?this.accel.x=-this.defaultAccelX:this.vel.x<0&&this.force.x==0?this.accel.x=this.defaultAccelX:this.accel.x=this.force.x,this.inputHandler.isKeyPressed(" ")&&this.onGround()&&(this.vel.y=this.defaultMaxJumpVel/2),this.inputHandler.isKeyPressed("c")&&!this.onGround()&&(this.vel.y=-this.defaultMaxJumpVel),this.accel.y=-this.defaultGravity):(this.inputHandler.isKeyPressed("w")?this.accel.z=this.defaultAccelZ:this.inputHandler.isKeyPressed("s")?this.accel.z=-this.defaultAccelZ:Math.abs(this.vel.z)<this.defaultMinVel?(this.accel.z=0,this.vel.z=0):this.vel.z>0?this.accel.z=-this.defaultDeaccel:this.accel.z=this.defaultDeaccel,this.inputHandler.isKeyPressed("a")?(this.vel.x=this.defaultVelX,this.force.x<0&&(this.vel.x=this.defaultVelX/2),this.accel.x+=this.force.x):this.inputHandler.isKeyPressed("d")?(this.vel.x=-this.defaultVelX,this.force.x>0&&(this.vel.x=-this.defaultVelX/2),this.accel.x+=this.force.x):Math.abs(this.vel.x)<this.defaultMinVel&&this.force.x==0?(this.accel.x=0,this.vel.x=0):this.vel.x>0&&this.force.x==0?this.accel.x=-this.defaultAccelX:this.vel.x<0&&this.force.x==0?this.accel.x=this.defaultAccelX:this.accel.x=this.force.x,this.inputHandler.isKeyPressed(" ")&&this.onGround()&&(this.vel.y=this.defaultMaxJumpVel),this.inputHandler.isKeyPressed("c")&&!this.onGround()&&(this.vel.y=-this.defaultMaxJumpVel),this.accel.y=-this.defaultGravity),this.inputHandler.isKeyPressed("\\")&&this.updateCondition("robotic")}updateVelocity(t){this.vel.add(this.accel.clone().multiplyScalar(t)),this.vel.x=Math.min(Math.max(this.vel.x,-this.defaultMaxVel),this.defaultMaxVel),this.vel.y=Math.min(Math.max(this.vel.y,-this.defaultMaxJumpVel),this.defaultMaxJumpVel),this.vel.z=Math.min(Math.max(this.vel.z,-this.defaultMaxVel),this.defaultMaxVel),this.condition=="robotic"&&(this.vel.z=Math.min(Math.max(this.vel.z,-this.defaultMaxVel/2),this.defaultMaxVel/2))}updatePosition(t){if(this.condition=="dance"||this.condition=="squashed"){this.vel.set(0,0,0),this.accel.set(0,0,0);return}this.mesh.position.add(this.vel.clone().multiplyScalar(t));const e=new p().setFromObject(this.mesh);for(const i in this.movableBoundary){const s=this.movableBoundary[i];i=="forward"&&e.max.z>s?(this.vel.z>0&&(this.vel.z=0),this.mesh.position.z-=e.max.z-s):i=="backward"&&e.min.z<s?(this.vel.z<0&&(this.vel.z=0),this.mesh.position.z+=s-e.min.z):i=="left"&&e.min.x<s?(this.vel.x<0&&(this.vel.x=0),this.mesh.position.x+=s-e.min.x):i=="right"&&e.max.x>s?(this.vel.x>0&&(this.vel.x=0),this.mesh.position.x-=e.max.x-s):i=="up"&&e.max.y>s?(this.vel.y>0&&(this.vel.y=0),this.mesh.position.y-=e.max.y-s):i=="down"&&e.min.y<s&&(this.vel.y<0&&(this.vel.y=0),this.mesh.position.y+=s-e.min.y)}}getMovement(){this.updateMovementTmp("walking"),this.vel.z==this.defaultMaxVel&&this.updateMovementTmp("running"),this.inputHandler.isKeyPressed("j")&&this.updateMovementTmp("punching"),this.onGround()||this.updateMovementTmp("jumping"),this.condition=="dance"&&this.updateMovementTmp("dance"),this.condition=="squashed"&&this.updateMovementTmp("squashed"),this.condition=="confusion"&&this.updateMovementTmp("confusion")}updateCondition(t){if(this.condition==t)return;this.condition=t;const e=this.updateConditionMesh(t);console.log("newgltf:",e),e!=this.gltf&&(this.changeGLTF(e),this.initAnimation()),this.condition=="dead"?(this.rescale(.5,.5,.5),this.cameraShake(1,200)):this.condition=="robotic"?(this.name=="spongeBob"?this.rescale(2,2,1.5):this.rescale(1.3,2.5,1.3),this.cameraShake(1,200)):this.condition=="dance"?(this.camera.closeUp(),this.cameraShake(1,200)):this.condition=="squashed"&&this.cameraShake(1,200)}updateMovement(t=0){if(this.punchingTime=Math.max(0,this.punchingTime-t),this.movement==this.newMovement||this.punchingTime>0)return;this.movement=this.newMovement;let{animationId:e}=this.updateMovementAnimation(this.movement);this.initAnimation(e),this.movement=="punching"&&(this.punchingTime=.4)}applyEffect(t,e){this.effects[t]&&this.effects[t].remove(this),this.effects[t]=e,e.apply(this)}pickEffect(t,e){this.waiting_effect=[t,e]}updateEffects(t){this.inputHandler.isKeyPressed("k")&&this.waiting_effect[0]!=""&&(this.applyEffect(this.waiting_effect[0],this.waiting_effect[1]),this.waiting_effect=["",{duration:0,apply:e=>{},remove:e=>{}}]);for(const e in this.effects){const i=this.effects[e];i.duration-=t,i.duration<=0&&(i.remove(this),delete this.effects[e])}}debugLogging(){this.condition=="robotic"&&(console.log("debug robot","position:",this.mesh.position),console.log("debug robot","box:",this.getBottomCenter()))}updateCamera(t){this.inputHandler.isKeyPressed("q")&&(this.camera.perspective="thirdPerson"),this.inputHandler.isKeyPressed("e")&&(this.camera.perspective="secondPerson"),this.camera.update()}tick(t){this.updateAcceleration(t),this.updateVelocity(t),this.updatePosition(t),this.updateBoundingBox(),this.updateEffects(t),this.updateCamera(t),this.updateMovement(t),this.animate(t),this.getMovement()}cameraShake(t,e){this.camera.shake(t,e)}reset(){this.updateCondition("normal"),this.newMovement="idle",this.updateMovement(),this.mesh.position.set(0,0,0),this.vel.set(0,0,0),this.accel.set(0,0,0)}}class kt extends X{constructor(t,e){let i={};i.normal=e.spongeBobAll,i.robotic=e.roboBob1,i.dead=e.spongeBobDraw,i.scary=e.scaryBob2,super(t,i.normal),this.gltfDict=i,this.init()}updateConditionMesh(t){let e;switch(t){case"normal":e=this.gltfDict.normal;break;case"robotic":e=this.gltfDict.robotic;break;case"dead":e=this.gltfDict.dead;break;case"scary":e=this.gltfDict.scary;break;default:e=this.gltfDict.normal;break}return e}updateMovementAnimation(t){let e=0;switch(t){case"idle":this.condition=="robotic"?e=9:this.condition=="normal"?e=20:e=0;break;case"dance":e=17;break;case"confusion":e=4;break;case"squashed":e=3;break;case"walking":this.condition=="robotic"?e=9:this.condition=="normal"?e=32:e=0;break;case"running":this.condition=="robotic"?e=9:this.condition=="normal"?e=28:e=0;break;case"jumping":this.condition=="robotic"?e=7:this.condition=="normal"?e=23:e=0;break;case"punching":this.condition=="robotic"?e=5:this.condition=="normal"?e=30:e=0;break;default:e=0;break}return{animationId:e}}}class Bt extends X{constructor(t,e){let i={};i.normal=e.patrickAll,i.robotic=e.patrickRobot,super(t,i.normal),this.gltfDict=i,this.init()}updateConditionMesh(t){let e;switch(t){case"normal":e=this.gltfDict.normal;break;case"robotic":e=this.gltfDict.robotic;break;default:e=this.gltfDict.normal;break}return e}updateMovementAnimation(t){let e=0;switch(t){case"idle":this.condition=="robotic"?e=0:this.condition=="normal"?e=13:e=12;break;case"dance":e=13;break;case"confusion":e=3;break;case"squashed":e=6;break;case"walking":this.condition=="robotic"?e=0:this.condition=="normal"?e=26:e=0;break;case"running":this.condition=="robotic"?e=0:this.condition=="normal"?e=4:e=0;break;case"jumping":this.condition=="robotic"?e=0:this.condition=="normal"?e=18:e=0;break;case"punching":this.condition=="robotic"?e=0:this.condition=="normal"?e=23:e=0;break;default:e=0;break}return{animationId:e}}}class L extends C{constructor(t,e){const i=m(e);super("obstacle",t,i),this.collidedCnt=0,this.colliding=!1,this.collidedThreshold=100,this.punchedTime=0,this.counter=0,this.audioManager=g.getInstance(),this.init()}init(){this.collidedCnt=0,this.colliding=!1,this.punchedTime=0,this.vel=new n(0,0,0)}updatePosition(t){this.mesh.position.add(this.vel.clone().multiplyScalar(t))}ensureOnGround(){(this.name.includes("rock")||this.name.includes("shiba")||this.name.includes("dog")||this.name.includes("cat"))&&this.getBottomCenter().y<=0&&(this.vel.y=0,this.counter==0&&(this.audioManager.playFallSound(),this.counter+=1))}rebound(){if(this.name.includes("tiki")){let t=Math.random();this.getTopCenter().y<=.15&&(t<.3?this.vel.y=1:t<.6?this.vel.y=.8:this.vel.y=1.2),this.getBottomCenter().y>=.1&&(t<.3?this.vel.y=-1:t<.6?this.vel.y=-.8:this.vel.y=-1.2)}}oscillate(){this.name.includes("boatTSCP")&&(this.getBottomCenter().x<=-3&&(this.vel.x=1),this.getBottomCenter().x>=3&&(this.vel.x=-1))}jellyfishMotion(){this.name.includes("jelly_fish")&&(this.getBottomCenter().y<=0&&this.getBottomCenter().x<=-3&&this.vel.y<0?(this.vel.y=0,this.vel.x=1):this.getBottomCenter().y<=0&&this.getBottomCenter().x>=3&&this.vel.x>0?Math.random()<.5?(this.vel.y=2,this.vel.x=0):(this.vel.y=0,this.vel.x=-1):this.getBottomCenter().y>=3&&this.getBottomCenter().x>=3&&this.vel.y>0?(this.vel.y=0,this.vel.x=-1.5):this.getBottomCenter().y>=3&&this.getBottomCenter().x<=-3&&this.vel.x<0?(this.vel.y=-2,this.vel.x=0):this.getBottomCenter().y<=0&&this.getBottomCenter().x<=-3&&this.vel.x<0?Math.random()<.5?(this.vel.y=0,this.vel.x=1):(this.vel.y=2,this.vel.x=0):this.getBottomCenter().y>=3&&this.getBottomCenter().x>=3&&this.vel.x>0?(this.vel.y=-2,this.vel.x=0):this.getBottomCenter().y>=3&&this.getBottomCenter().x<=-3&&this.vel.y>0?(this.vel.y=0,this.vel.x=1.5):this.getBottomCenter().y<=0&&this.getBottomCenter().x>=3&&this.vel.y<0&&(this.vel.y=0,this.vel.x=-1))}phantomMotion(){this.name.includes("phantom")&&(this.getBottomCenter().y<=1.5&&this.getBottomCenter().x<=-3&&this.vel.y<0?(this.vel.y=0,this.vel.x=1):this.getBottomCenter().y<=1.5&&this.getBottomCenter().x>=3&&this.vel.x>0?Math.random()<.5?(this.vel.y=2,this.vel.x=0):(this.vel.y=0,this.vel.x=-1):this.getBottomCenter().y>=3&&this.getBottomCenter().x>=3&&this.vel.y>0?(this.vel.y=0,this.vel.x=-1.5):this.getBottomCenter().y>=3&&this.getBottomCenter().x<=-3&&this.vel.x<0?(this.vel.y=-2,this.vel.x=0):this.getBottomCenter().y<=1.5&&this.getBottomCenter().x<=-3&&this.vel.x<0?Math.random()<.5?(this.vel.y=0,this.vel.x=1):(this.vel.y=2,this.vel.x=0):this.getBottomCenter().y>=3&&this.getBottomCenter().x>=3&&this.vel.x>0?(this.vel.y=-2,this.vel.x=0):this.getBottomCenter().y>=3&&this.getBottomCenter().x<=-3&&this.vel.y>0?(this.vel.y=0,this.vel.x=1.5):this.getBottomCenter().y<=1.5&&this.getBottomCenter().x>=3&&this.vel.y<0&&(this.vel.y=0,this.vel.x=-1))}tick(t){this.animate(t),this.updatePosition(t),this.updateBoundingBox(),this.ensureOnGround(),this.rebound(),this.jellyfishMotion(),this.phantomMotion(),this.oscillate()}}function q(l){l.traverse(t=>{if(t.isMesh){const e=t;e.castShadow=!0,e.receiveShadow=!0}})}class It{constructor(t){this.seed=0,this.gltfDict={},this.themes=["all","normal","bikini_bottom","windy_food","vehicles","dungeon","statues","food","special","phantom","final"],this.themeDict={},this.themeDecorateDict={},this.sizeDict={},this.rotateDict={},this.velDict={},console.log("generator created"),this.gltfDict=t,this.init()}init(){this.seed=Date.now(),this.themes.forEach(t=>{this.themeDict[t]=[]});for(let t in this.gltfDict)t!="wooden_fence"&&this.themeDict.all.push(t);this.initThemes(),this.initSizeDict(),this.initRotateDict(),this.initVelDict()}initThemes(){this.themeDict.normal=["jelly_fish"],this.themeDict.phantom=["phantom"],this.themeDict.bikini_bottom=["squidwardHouseTSCP","pineapple_house","lightHouseTSCP","krabTSCP","bottom","chum_bucket"],this.themeDict.windy_food=["burger","table","spatula","barrelTSCP"],this.themeDict.food=["burger","burger","table","spatula","barrelTSCP"],this.themeDict.vehicles=["car2","bus2TSCP","train","train","boatTSCP","train"],this.themeDict.dungeon=["tiki_wood","tiki_wood","tiki_wood","tiki_wood","tikiToren"],this.themeDict.statues=["cat","dog","cat","dog","shiba","rabbit"],this.themeDict.final=["car2","burger","lightHouseTSCP","jelly_fish","cat","dog"],this.themeDict.special=["realBob"],this.themeDecorateDict.normal=["swimmingRing","jellyNet","jellyfish3"],this.themeDecorateDict.food=["krabDollar","krabMenu","mrKrab","krabTable","spatula","barrelTSCP"],this.themeDecorateDict.bikini_bottom=["building1TSCP","building2TSCP"],this.themeDecorateDict.windy_food=["building1TSCP","building2TSCP"],this.themeDecorateDict.vehicles=["building1TSCP","building2TSCP"],this.themeDecorateDict.dungeon=["patrickStatue","spongehengeTSCP","tomb"],this.themeDecorateDict.statues=["cow","rabbit"],this.themeDecorateDict.final=["mrKrab"]}initSizeDict(){this.themeDict.all.forEach(t=>{this.sizeDict[t]=new n(1,1,1)}),this.sizeDict.pineapple_house=new n(2,3,2),this.sizeDict.lightHouseTSCP=new n(2,5,2),this.sizeDict.squidwardHouseTSCP=new n(2,4,2),this.sizeDict.chum_bucket=new n(2,4.5,2),this.sizeDict.krabTSCP=new n(4,3,3),this.sizeDict.bottom=new n(2,.3,2),this.sizeDict.boatTSCP=new n(1,1,2),this.sizeDict.busTSCP=new n(6,2,2),this.sizeDict.bus2TSCP=new n(5,2,2),this.sizeDict.car2=new n(1,1,2),this.sizeDict.train=new n(2,3,10),this.sizeDict.burger=new n(2,2,2),this.sizeDict.spatula=new n(.3,1,.3),this.sizeDict.barrelTSCP=new n(1,1,1),this.sizeDict.table=new n(1,.5,1),this.sizeDict.krabDollar=new n(.1,1,2),this.sizeDict.krabMenu=new n(3,3,.5),this.sizeDict.mrKrab=new n(2,2.5,1),this.sizeDict.krabSign=new n(1,3,1),this.sizeDict.krabTable=new n(2,1,2),this.sizeDict.rock=new n(3,3,3),this.sizeDict.shiba=new n(2,2,2),this.sizeDict.cat=new n(3,3,3),this.sizeDict.dog=new n(3,3,3),this.sizeDict.rabbit=new n(2,2,2),this.sizeDict.cow=new n(2,2,2),this.sizeDict.tikiStand=new n(1.75,2.5,1.75),this.sizeDict.tikiToren=new n(1.75,2.75,1.75),this.sizeDict.tiki_wood=new n(1.75,1.75,1.75),this.sizeDict.phantom=new n(1,1.5,1),this.sizeDict.spongehengeTSCP=new n(2.4,3.6,.7),this.sizeDict.patrickStatue=new n(2,3,2),this.sizeDict.tomb=new n(2,2,2),this.sizeDict.jelly_fish=new n(1.2,2,1.2),this.sizeDict.jellyNet=new n(1.2,2.5,1.2),this.sizeDict.jellyfish3=new n(1.5,2,1.5),this.sizeDict.realBob=new n(10,20,8),this.sizeDict.hat=new n(.2,.5,.2),this.sizeDict.boat=new n(1,1,2),this.sizeDict.karen=new n(.4,1,.4),this.sizeDict.snailClock=new n(1.6,1.6,.8),this.sizeDict.house1=new n(1,2,1),this.sizeDict.clock=new n(2,5,2),this.sizeDict.bed=new n(1,1,2),this.sizeDict.tableTSCP=new n(3,1,3),this.sizeDict.chair1=new n(2,2,2),this.sizeDict.swimmingRing=new n(1.5,.5,1.5),this.sizeDict.checkPoint=new n(1,3.5,1),this.sizeDict.mill1=new n(5,5,5),this.sizeDict.mill2=new n(5,5,5),this.sizeDict.wooden_fence=new n(3,1.2,.1),this.sizeDict.building1TSCP=new n(2.5,5,2.5),this.sizeDict.building2TSCP=new n(3,6,3),console.log("generator initialized",this.themeDict)}initRotateDict(){this.themeDict.all.forEach(t=>{this.rotateDict[t]=new n(0,0,0)}),this.rotateDict.burger=new n(0,Math.PI/2,0),this.rotateDict.busTSCP=new n(0,3*Math.PI/2,0),this.rotateDict.bus2TSCP=new n(0,3*Math.PI/2,0),this.rotateDict.boatTSCP=new n(0,Math.PI/2,0),this.rotateDict.pattywagon=new n(0,Math.PI,0),this.rotateDict.car2=new n(0,Math.PI,0),this.rotateDict.spongehenge=new n(0,Math.PI,0),this.rotateDict.bed=new n(0,0,0),this.rotateDict.snailClock=new n(0,Math.PI,0),this.rotateDict.chair1=new n(0,Math.PI,0),this.rotateDict.hat=new n(0,Math.PI,0),this.rotateDict.clock=new n(0,Math.PI,0),this.rotateDict.patrickStatue=new n(0,Math.PI,0),this.rotateDict.squidwardHouseTSCP=new n(0,Math.PI,0),this.rotateDict.pineappleHouseTSCP=new n(0,Math.PI,0),this.rotateDict.pineapple_house=new n(0,Math.PI,0),this.rotateDict.krabTSCP=new n(0,Math.PI,0),this.rotateDict.house1=new n(0,Math.PI,0),this.rotateDict.tiki_wood=new n(0,Math.PI,0),this.rotateDict.tikiToren=new n(0,Math.PI,0),this.rotateDict.jelly_fish=new n(0,Math.PI,0),this.rotateDict.jellyNet=new n(0,Math.PI,0),this.rotateDict.shiba=new n(0,Math.PI,0),this.rotateDict.cat=new n(0,Math.PI,0),this.rotateDict.dog=new n(0,Math.PI,0),this.rotateDict.rabbit=new n(0,Math.PI,0),this.rotateDict.cow=new n(0,Math.PI,0),this.rotateDict.phantom=new n(0,Math.PI,0),this.rotateDict.mrKrab=new n(0,Math.PI,0),this.rotateDict.krabPack=new n(0,Math.PI/2,0),this.rotateDict.krabDollar=new n(0,-Math.PI/2,0),this.rotateDict.krabMenu=new n(0,Math.PI,0),this.rotateDict.realBob=new n(0,Math.PI,0)}initVelDict(){this.themeDict.all.forEach(t=>{this.velDict[t]=new n(0,0,0)}),this.velDict.train=new n(0,0,-1.5),this.velDict.bus2TSCP=new n(0,0,-1),this.velDict.boatTSCP=new n(1,0,0),this.velDict.car2=new n(0,0,-2.5),this.velDict.rock=new n(0,-4,0),this.velDict.cat=new n(0,-4,0),this.velDict.dog=new n(0,-4,0),this.velDict.tiki_wood=new n(0,-1,0),this.velDict.jelly_fish=new n(1,0,0),this.velDict.phantom=new n(1,0,0)}randomObstacle(t=-1,e="normal",i=NaN){let s,o;console.log("parse in  theme ",e),this.themes.includes(e)||(e="normal"),console.log("trying to randomObstacle from theme ",e);const{random:a,newSeed:r}=W(this.seed);this.seed=r,o=this.themeDict[e][Math.floor(a*this.themeDict[e].length)],q(m(this.gltfDict[o]).scene),s=new L(o+"_"+t,m(this.gltfDict[o])),(isNaN(i.x)||isNaN(i.y)||isNaN(i.z))&&(i=this.sizeDict[o]),s.rescale(i.x,i.y,i.z);{const c=new p().setFromObject(s.mesh);c.getSize(new n),console.log("new obstacle generated",s.name,c)}s.rotate("x",this.rotateDict[o].x),s.rotate("y",this.rotateDict[o].y),s.rotate("z",this.rotateDict[o].z);let h=this.velDict[o].clone();for(let c=0;c<3;c++){let d=(Math.random()-.5)*1.5;Math.random()>.5&&(d=-d),o.includes("tiki"),h.setComponent(c,h.getComponent(c)*Math.exp(d)),(o.includes("phantom")||o.includes("jelly_fish"))&&Math.random()>.5&&h.setComponent(c,-h.getComponent(c))}return s.vel=h,s}randomDecoration(t=-1,e="normal",i=NaN){let s,o;console.log("parse in  theme ",e),this.themes.includes(e)||(e="normal");const{random:a,newSeed:r}=W(this.seed);this.seed=r,o=this.themeDecorateDict[e][Math.floor(a*this.themeDecorateDict[e].length)],q(m(this.gltfDict[o]).scene),s=new L(o+"_"+t,m(this.gltfDict[o])),(isNaN(i.x)||isNaN(i.y)||isNaN(i.z))&&(i=this.sizeDict[o]),s.rescale(i.x,i.y,i.z);{const c=new p().setFromObject(s.mesh);c.getSize(new n),console.log("new obstacle generated",s.name,c)}s.rotate("x",this.rotateDict[o].x),s.rotate("y",this.rotateDict[o].y),s.rotate("z",this.rotateDict[o].z);let h=this.velDict[o].clone();for(let c=0;c<3;c++){let d=(Math.random()-.4)*1.5;Math.random()>.5&&(d=-d),h.setComponent(c,h.getComponent(c)*Math.exp(d))}return s.vel=h,s}centainObstacle(t,e=-1,i=NaN){let s;return s=new L(t+"_"+e,this.gltfDict[t]),(isNaN(i.x)||isNaN(i.y)||isNaN(i.z))&&(i=this.sizeDict[t]),s.rescale(i.x,i.y,i.z),s}}class z extends C{constructor(t,e){const i=m(e);super("item",t,i),this.audioManager=g.getInstance(),this.init();const s=new dt(this.mesh.geometry),o=new mt({color:16777215});this.outlineMesh=new ut(s,o),this.mesh.add(this.outlineMesh)}init(){}tick(t){this.mesh.position.y+=Math.sin(Date.now()*.001*3)*.5*t,this.animate(t),this.updateBoundingBox()}}class _ extends z{constructor(t,e){super(t,e),this.effect={duration:5,apply:i=>{i.defaultMaxVel*=2},remove:i=>{i.defaultMaxVel/=2}}}applyEffect(t){t.pickEffect("speedBoost",this.effect)}}class G extends z{constructor(t,e){super(t,e),this.effect={duration:10,apply:i=>{i.defaultMaxJumpVel*=1.5},remove:i=>{i.defaultMaxJumpVel/=1.5}}}applyEffect(t){t.pickEffect("highJump",this.effect)}}class O extends z{constructor(t,e){super(t,e),this.effect={duration:10,apply:i=>{i.updateCondition("robotic")},remove:i=>{i.updateCondition("normal")}}}applyEffect(t){t.pickEffect("robotic",this.effect)}}class H extends z{constructor(t,e){super(t,e),this.effect={duration:3,apply:i=>{i.updateCondition("dance")},remove:i=>{i.updateCondition("normal")}}}applyEffect(t){t.applyEffect("dance",this.effect),this.audioManager.playDanceSound()}}class At extends z{constructor(t,e){super(t,e),this.effect={duration:1,apply:i=>{},remove:i=>{}}}applyEffect(t){}}class Et{constructor(t){this.seed=0,this.gltfDict={},this.themes=["all","normal","bikini_bottom","vehicles","windy_food","statues","dungeon"],this.themeDict={},this.sizeDict={},this.rotationDict={},console.log("generator created"),this.gltfDict=t,this.init()}init(){this.seed=0,this.themes.forEach(t=>{this.themeDict[t]=[]});for(let t in this.gltfDict)this.themeDict.all.push(t);this.initSizeDict()}initSizeDict(){this.themeDict.all.forEach(t=>{this.sizeDict[t]=new n(1,1,1),this.rotationDict[t]=new n(0,0,0)}),this.sizeDict.sodaTSCP=new n(.6,1,.6),this.sizeDict.disco_ball=new n(.7,.05,.7),this.rotationDict.disco_ball=new n(-Math.PI/3,0,0),this.sizeDict.sauceTSCP=new n(.6,1,.6),this.sizeDict.infoSign=new n(1,1,.7),this.sizeDict.xbox_controller_lp=new n(.6,.6,.6),this.sizeDict.star=new n(.6,.6,.6),this.rotationDict.sodaTSCP=new n(0,Math.PI/2,0),this.rotationDict.sauceTSCP=new n(0,Math.PI/2,0),this.rotationDict.infoSign=new n(0,Math.PI,0),this.rotationDict.xbox_controller_lp=new n(0,Math.PI,0),this.rotationDict.star=new n(0,0,0),console.log("generator initialized",this.themeDict)}randomItem(t=-1,e="all",i=NaN){let s,o;e in this.themes||(e="all");const a=Math.random(),r=Math.random();o=this.themeDict[e][Math.floor(a*this.themeDict[e].length)],o.includes("soda")?s=new _(o+"_"+t,m(this.gltfDict[o])):o.includes("xbox")?s=new O(o+"_"+t,m(this.gltfDict[o])):o.includes("disco")?s=new H(o+"_"+t,m(this.gltfDict[o])):o.includes("sauce")?s=new G(o+"_"+t,m(this.gltfDict[o])):r<.25?s=new G("sodaTSCP_"+t,m(this.gltfDict[o])):r<.5?s=new _("sauceTSCP_"+t,m(this.gltfDict[o])):r<.75?s=new O("xbox_controller_lp_"+t,m(this.gltfDict[o])):s=new H("discoball_"+t,m(this.gltfDict[o])),(isNaN(i.x)||isNaN(i.y)||isNaN(i.z))&&(i=this.sizeDict[o]),s.rescale(i.x,i.y,i.z);{const h=new p().setFromObject(s.mesh);h.getSize(new n),console.log("new Item generated",s.name,h)}return s.rotate("x",this.rotationDict[o].x),s.rotate("y",this.rotationDict[o].y),s.rotate("z",this.rotationDict[o].z),s}centainItem(t,e=-1,i=NaN){let s;return t.includes("soda")?s=new _(t+"_"+e,m(this.gltfDict[t])):t.includes("info")?s=new O(t+"_"+e,m(this.gltfDict[t])):t.includes("sauce")?s=new G(t+"_"+e,m(this.gltfDict[t])):t.includes("star")?s=new At(t+"_"+e,m(this.gltfDict[t])):s=new H(t+"_"+e,m(this.gltfDict[t])),(isNaN(i.x)||isNaN(i.y)||isNaN(i.z))&&(i=this.sizeDict[t]),s.rescale(i.x,i.y,i.z),s}}class K extends M{constructor(t,e=10,i=10){console.log("createWall");const s=new P(e,i),o=new x({color:"transparent",side:I,transparent:!0,opacity:0}),a=new b(s,o);a.receiveShadow=!0,super("ground",t,a)}setAsLeftWall(){this.mesh.position.x=-3.4,this.mesh.rotation.y=Math.PI/2}setAsRightWall(){this.mesh.position.x=3.4,this.mesh.rotation.y=-Math.PI/2}}class Tt extends M{constructor(t,e=10,i=1e3,s=null,o=1,a=1){console.log("createGround");const r=new P(e,i);let h;s?(s.wrapS=B,s.wrapT=B,s.repeat.set(e/o,i/a),h=new x({map:s,side:I})):h=new x({color:8421504});const c=new b(r,h);c.rotation.x=-Math.PI/2,c.receiveShadow=!0,super("ground",t,c),this.createGround(e,i)}createGround(t=5,e=1e3){}}class Lt extends M{constructor(t,e=5,i=8){console.log("createCeiling");const s=new P(e,i),o=new x({color:"transparent",side:I,transparent:!0,opacity:0}),a=new b(s,o);a.rotation.x=Math.PI/2,a.receiveShadow=!0,super("ground",t,a),this.setCeiling(i)}setCeiling(t){this.mesh.position.y=t/2}}class _t extends M{constructor(t,e=10,i=10,s=null,o=1,a=1){console.log("createDome");const r=e/2,h=i,c=32,d=1,u=!0,A=0,J=Math.PI,Z=new ft(r,r,h,c,d,u,A,J);let E;s?(s.wrapS=B,s.wrapT=B,s.repeat.set(e/o,i/a),E=new x({map:s,side:I})):E=new x({color:8421504});const S=new b(Z,E);S.rotation.z=Math.PI/2,S.rotation.y=Math.PI/2,S.receiveShadow=!0,super("dome",t,S)}setDome(t){this.mesh.position.y=t}}const D=20,Gt=10,f=class f extends C{constructor(t,e,i,s,o,a={},r="all"){const h=new pt;super("stage",e,h),this.obstacles=[],this.items=[],this.theme="normal",this.themes=["normal","bikini_bottom","windy_food","vehicles","dungeon","statues","special","final"],this.length=200,this.nearestObstacles=[],this.obstaclePointerL=0,this.obstaclePointerR=0,this.nearestItems=[],this.itemPointerL=0,this.itemPointerR=0,this.textureDict={},this.specialIntervals=[],this.textureDict=a,this.obstacleGenerator=s,this.itemGenerator=o,this.mesh=h,this.length=f.LENGTH,r=="all"?this.theme=this.themes[Math.floor(Math.random()*this.themes.length)]:this.theme=r,console.log("theme:",this.theme),this.length*i,this.scene=t.getScene(),this.scene.add(this.mesh),this.leftWall=new K("leftWall",f.LENGTH,this.length),this.rightWall=new K("rightWall",f.LENGTH,this.length),this.ceiling=new Lt("ceiling",f.WIDTH,this.length);let[c,d,u]=this.theme2texture(this.theme,!0);this.ground=new Tt("ground",f.WIDTH*10,this.length,c,d,u),[c,d,u]=this.theme2texture(this.theme,!1),this.dome=new _t("dome",f.WIDTH*5,this.length,c,d,u),this.ground.mesh.position.z=this.length/2-D,this.leftWall.mesh.position.z=this.length/2-D,this.rightWall.mesh.position.z=this.length/2-D,this.ceiling.mesh.position.z=this.length/2-D,this.dome.mesh.position.z=this.length/2-D,this.leftWall.setAsLeftWall(),this.rightWall.setAsRightWall(),this.ceiling.setCeiling(f.HEIGHT),this.mesh.add(this.ground.mesh),this.theme!="special"&&(this.mesh.add(this.leftWall.mesh),this.mesh.add(this.rightWall.mesh),this.mesh.add(this.ceiling.mesh),this.mesh.add(this.dome.mesh)),this.initStage(),this.initObstacles(this.length,f.WIDTH),this.initItems(this.length,f.WIDTH)}theme2texture(t,e){let i,s,o;return e?t=="vehicles"?(i=this.textureDict.road,s=7,o=7):t=="bikini_bottom"?(i=this.textureDict.sand,s=1,o=1):t=="food"?(i=this.textureDict.wood,s=2,o=2):t=="special"?(i=this.textureDict.woodwet,s=3,o=3):t=="dungeon"?(i=this.textureDict.afiPat2,s=3,o=3):t=="statues"?(i=this.textureDict.artgorl,s=20,o=20):(i=this.textureDict.grass,s=1,o=1):t=="statues"?(i=this.textureDict.cute,s=10,o=10):t=="bikini_bottom"?(i=this.textureDict.colorful,s=1,o=1):t=="food"?(i=this.textureDict.block,s=5,o=5):t=="dungeon"?(i=this.textureDict.afiPat,s=3,o=3):t=="normal"?(i=this.textureDict.flower2,s=10,o=10):(i=this.textureDict.flower2,s=10,o=10),[i,s,o]}initStage(){}checkCollision(t,e){const i=new p().setFromObject(t.mesh);i.translate(e.clone().sub(t.mesh.position));const s=.2;i.min.sub(new n(s,s,s)),i.max.add(new n(s,s,s));for(const o of this.obstacles){const a=new p().setFromObject(o.mesh);if(i.intersectsBox(a))return!0}return!1}findValidPosition(t,e,i,s){for(let o=0;o<Gt;o++){const a=Math.random()*e-e/2,r=0,h=i+Math.random()*s,c=new n(a,r,h);if(!this.checkCollision(t,c))return c}return null}addGroundImage(t,e,i){const s=new gt;Math.random()>.5?s.load("../assets_/pics/cat.png",o=>{const a=new P(3,3),r=new R({map:o,transparent:!0}),h=new b(a,r);h.position.set(t,e+Math.random()/100,i),h.rotation.x=-Math.PI/2,h.rotation.z=Math.PI,this.mesh.add(h)}):s.load("../assets_/pics/dog.png",o=>{const a=new P(3,3),r=new R({map:o,transparent:!0}),h=new b(a,r);h.position.set(t,e+Math.random()/100,i),h.rotation.x=-Math.PI/2,h.rotation.z=Math.PI,this.mesh.add(h)})}initObstacles(t,e){if(this.theme=="special"){const o=this.obstacleGenerator.centainObstacle("realBob");this.obstacles.push(o),this.mesh.add(o.mesh),o.setPosition(0,0,0),this.obstaclePointerL=0,this.obstaclePointerR=1;return}const i=1.5,s=Math.floor(t/i);for(let o=0;o<s;o++){const a=this.obstacleGenerator.centainObstacle("wooden_fence");a.rotate("y",Math.PI/2),this.obstacles.push(a),this.mesh.add(a.mesh);const r=-3.5,h=0,c=o*i;a.setPosition(r,h,c)}for(let o=0;o<s;o++){const a=this.obstacleGenerator.centainObstacle("wooden_fence");a.rotate("y",-Math.PI/2),this.obstacles.push(a),this.mesh.add(a.mesh);const r=3.5,h=0,c=o*i;a.setPosition(r,h,c)}if(this.theme=="windy_food"||this.theme=="final")for(let o=0;o<5;o++)if(Math.random()>=.5){const h=o*20;if(Math.random()>=.5){const c=this.obstacleGenerator.centainObstacle("mill1");c.rotate("y",Math.PI),this.obstacles.push(c),this.mesh.add(c.mesh),c.setPosition(6,-.1,h),this.specialIntervals.push([h-this.obstacleGenerator.sizeDict.mill1.z/2,h+this.obstacleGenerator.sizeDict.mill1.z/2,"wind_from_left"])}else{const c=this.obstacleGenerator.centainObstacle("mill2");this.obstacles.push(c),this.mesh.add(c.mesh),c.setPosition(6,-.1,h),this.specialIntervals.push([h-this.obstacleGenerator.sizeDict.mill2.z/2,h+this.obstacleGenerator.sizeDict.mill2.z/2,"wind_from_left"])}}else{const h=o*20;if(Math.random()>=.5){const c=this.obstacleGenerator.centainObstacle("mill1");this.obstacles.push(c),this.mesh.add(c.mesh),c.setPosition(-6,-.1,h),this.specialIntervals.push([h-this.obstacleGenerator.sizeDict.mill1.z/2,h+this.obstacleGenerator.sizeDict.mill1.z/2,"wind_from_right"])}else{const c=this.obstacleGenerator.centainObstacle("mill2");c.rotate("y",Math.PI),this.obstacles.push(c),this.mesh.add(c.mesh),c.setPosition(-6,-.1,h),this.specialIntervals.push([h-this.obstacleGenerator.sizeDict.mill2.z/2,h+this.obstacleGenerator.sizeDict.mill2.z/2,"wind_from_right"])}}else{const a=Math.floor(t/5);for(let r=0;r<a;r++){const h=this.obstacleGenerator.randomDecoration(r,this.theme);this.obstacles.push(h),this.mesh.add(h.mesh);let c=6;Math.random()>.5&&(c=-6),c+=(Math.random()-.5)*2;let d=0;(h.name.includes("Menu")||h.name.includes("jellyfish3"))&&(d=2+Math.random()*2);const u=r*5+(Math.random()-.5)*5;h.setPosition(c,d,u)}}if(this.theme=="final"){for(let o=0;o<s*1.2;o++){const a=this.obstacleGenerator.randomObstacle(o,this.theme),r=this.findValidPosition(a,e,o*4,4);r?(this.obstacles.push(a),this.mesh.add(a.mesh),a.name.includes("dog")||a.name.includes("cat")?(a.setPosition(r.x,r.y+30,r.z),this.addGroundImage(r.x,r.y,r.z)):a.setPosition(r.x,r.y,r.z)):a.destruct()}for(let o=0;o<this.length/7.5;o++){const h=o*7.5,c=this.obstacleGenerator.randomObstacle(o,"phantom");this.obstacles.push(c),this.mesh.add(c.mesh),c.setPosition(0,1.5,h)}}if(this.theme=="statues")for(let o=0;o<s*1.5;o++){const a=this.obstacleGenerator.randomObstacle(o,this.theme),r=2,h=new n(Math.random()*e-e/2,0,o*r+Math.random()*r);this.obstacles.push(a),this.mesh.add(a.mesh),a.name.includes("dog")||a.name.includes("cat")?(a.setPosition(h.x,h.y+30,h.z),this.addGroundImage(h.x,h.y,h.z)):a.setPosition(h.x,h.y,h.z)}else if(this.theme=="dungeon"){for(let o=0;o<this.length/1.75;o++){const a=[-2.635,-.875,.875,2.635],r=0,h=o*1.75;for(let c=0;c<4;c++){const d=this.obstacleGenerator.randomObstacle(o*4+c,this.theme);this.obstacles.push(d),this.mesh.add(d.mesh),d.setPosition(a[c],r,h)}}for(let o=0;o<this.length/7.5;o++){const h=o*7.5,c=this.obstacleGenerator.randomObstacle(o,"phantom");this.obstacles.push(c),this.mesh.add(c.mesh),c.setPosition(0,1.5,h)}}else for(let o=0;o<s*1.5;o++){const a=this.obstacleGenerator.randomObstacle(o,this.theme),r=this.findValidPosition(a,e,o*i,i);r?(this.obstacles.push(a),this.mesh.add(a.mesh),a.setPosition(r.x,r.y,r.z)):a.destruct()}for(this.obstacles.sort((o,a)=>o.getBottomCenter().z-a.getBottomCenter().z);this.obstacles.length>0&&this.obstacles[this.obstacles.length-1].getBottomCenter().z>this.length;)this.obstacles[this.obstacles.length-1].destruct(),this.obstacles.pop();this.obstaclePointerL=0,this.obstaclePointerR=1}initItems(t,e){if(this.theme=="special"){this.itemPointerL=0,this.itemPointerR=1;return}const i=30,s=Math.floor(t/i);for(let r=0;r<s;r++){const h=this.itemGenerator.randomItem(r,this.theme);this.items.push(h),this.mesh.add(h.mesh);const c=Math.random()*e-e/2,d=.5+Math.random()*1.5,u=r*i+Math.random()*i;this.theme=="dungeon"?h.setPosition(c,d+1,u):h.setPosition(c,d,u)}const o=30,a=Math.floor(t/o);for(let r=0;r<a;r++){const h=this.itemGenerator.centainItem("star",r);this.items.push(h),this.mesh.add(h.mesh);const c=Math.random()*e-e/2,d=.5+Math.random()*1.5,u=r*o+Math.random()*o;this.theme=="dungeon"?h.setPosition(c,d+1,u):h.setPosition(c,d,u)}for(this.items.sort((r,h)=>r.getBottomCenter().z-h.getBottomCenter().z);this.items.length>0&&this.items[this.items.length-1].getBottomCenter().z>this.length;)this.items[this.items.length-1].destruct(),this.items.pop();this.itemPointerL=0,this.itemPointerR=1}updateNearestList(t,e=10){for(;this.obstaclePointerL>0&&this.obstacles[this.obstaclePointerL-1].getBottomCenter().z>t.z-e;)this.obstaclePointerL--;for(;this.obstaclePointerL<this.obstacles.length&&this.obstacles[this.obstaclePointerL].getBottomCenter().z<t.z-e;)this.obstaclePointerL++;for(;this.obstaclePointerR<this.obstacles.length&&this.obstacles[this.obstaclePointerR].getBottomCenter().z<t.z+e;)this.obstaclePointerR++;for(;this.obstaclePointerR>0&&(!this.obstacles[this.obstaclePointerR-1]||this.obstacles[this.obstaclePointerR-1].getBottomCenter().z>t.z+e);)this.obstaclePointerR--;for(this.nearestObstacles=this.obstacles.slice(this.obstaclePointerL,this.obstaclePointerR);this.itemPointerL>0&&this.items[this.itemPointerL-1].getBottomCenter().z>t.z-e;)this.itemPointerL--;for(;this.itemPointerL<this.items.length&&this.items[this.itemPointerL].getBottomCenter().z<t.z-e;)this.itemPointerL++;for(;this.itemPointerR<this.items.length&&this.items[this.itemPointerR].getBottomCenter().z<t.z+e;)this.itemPointerR++;for(;this.itemPointerR>0&&(!this.items[this.itemPointerR-1]||this.items[this.itemPointerR-1].getBottomCenter().z>t.z+e);)this.itemPointerR--;this.nearestItems=this.items.slice(this.itemPointerL,this.itemPointerR)}removeItem(t){this.items=this.items.filter(e=>e!==t),t.destruct(this.scene)}removeObstacle(t){this.obstacles=this.obstacles.filter(e=>e!==t),t.destruct(this.scene)}destruct(){this.ground.destruct(),this.leftWall.destruct(),this.rightWall.destruct(),this.ceiling.destruct(),this.dome.destruct(),this.obstacles.forEach(t=>{t.destruct()}),this.items.forEach(t=>{t.destruct()}),super.destruct()}reset(){this.obstacles.forEach(t=>{t.destruct()}),this.items.forEach(t=>{t.destruct()}),this.obstacles=[],this.items=[],this.initObstacles(f.LENGTH,f.WIDTH),this.initItems(f.LENGTH,f.WIDTH)}tick(t){this.nearestObstacles.forEach(e=>{e.tick(t)}),this.nearestItems.forEach(e=>{e.tick(t)})}};f.LENGTH=100,f.WIDTH=7,f.HEIGHT=15,f.START_Z=0;let v=f;class Ot extends C{constructor(t,e){const i=m(e);super("enemy",t,i),this.init()}init(){}tick(t){this.animate(t),this.updateBoundingBox()}}class Ht{constructor(t,e,i,s,o={},a){this.stages=[],this.textureDict={},this.stageidx=0,this.totalTime=0,this.enemyMinVel=.8,this.enemyMaxVel=3,this.enemyDist=15,this.enemyPos=-20,this.collectedStars=0,this.enterSpecialStageLol=!1,this.alreadyEnteredSpecialStage=!1,this.scene=t,this.character=e,this.obstacleGenerator=i,this.itemGenerator=s,this.textureDict=o,this.uicontroller=a,this.audioManager=g.getInstance()}init(){for(let t of this.stages)t.destruct();this.stages=[],this.stages.push(new v(this.scene,"stage1",0,this.obstacleGenerator,this.itemGenerator,this.textureDict,this.getTheme())),this.stageidx=0,this.enemy=new Ot("jellyKing",this.obstacleGenerator.gltfDict.fish),this.enemy.rescale(5,4,4),this.scene.getScene().add(this.enemy.mesh),this.enemy.setPosition(0,0,-20),this.initFog()}initFog(){this.scene.getScene().fog=new bt(8900346,.5,40);const t=new V(16777215,1);t.position.set(30,30,50),t.castShadow=!0,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,t.shadow.camera.near=.5,t.shadow.camera.far=500,t.shadow.camera.left=-50,t.shadow.camera.right=50,t.shadow.camera.top=50,t.shadow.camera.bottom=-50,this.directionLight=t,this.scene.getScene().add(this.directionLight)}getTheme(){return this.enterSpecialStageLol?"special":this.collectedStars<1?"normal":this.collectedStars<4?"food":this.collectedStars<7?"vehicles":this.collectedStars<11?"windy_food":this.collectedStars<15?"dungeon":this.collectedStars<20?"statues":this.collectedStars<25?"bikini_bottom":"final"}changeStage(){console.log("change stage"),this.stageidx+=1,this.stages.push(new v(this.scene,"stage"+(this.stageidx+1),this.stageidx,this.obstacleGenerator,this.itemGenerator,this.textureDict,this.getTheme())),this.stages[this.stageidx].mesh.position.z=this.stages[this.stageidx-1].mesh.position.z+this.stages[this.stageidx-1].length,this.stageidx>1&&this.stages[this.stageidx-2].destruct()}getCharactorMovableBoundary(){let t={forward:1e4,backward:-1e3,left:-1e3,right:1e3,up:1e3,down:0},e=this.stages[this.stageidx];if(this.character.condition!="robotic")for(let i of e.nearestObstacles)j(this.character,i,t);if(t.up=Math.min(t.up,e.ceiling.mesh.position.y),t.down=Math.max(t.down,e.ground.mesh.position.y),t.left=Math.max(t.left,e.leftWall.mesh.position.x),t.right=Math.min(t.right,e.rightWall.mesh.position.x),this.stageidx>0&&(e=this.stages[this.stageidx-1]),this.character.condition!="robotic")for(let i of e.nearestObstacles)j(this.character,i,t);t.up=Math.min(t.up,e.ceiling.mesh.position.y),t.down=Math.max(t.down,e.ground.mesh.position.y),t.left=Math.max(t.left,e.leftWall.mesh.position.x),t.right=Math.min(t.right,e.rightWall.mesh.position.x),this.character.movableBoundary=t}checkCollisionItems(t){for(let e of t.nearestItems)if(k(this.character,e)){if(this.audioManager.playPickItemSound(),console.log("collide with item ",e.name),e.applyEffect(this.character),e.name.includes("xbox"))this.uicontroller.swapItem("metal");else if(e.name.includes("soda"))this.uicontroller.swapItem("green");else if(e.name.includes("sauce"))this.uicontroller.swapItem("pink");else if(e.name.includes("star")){this.collectedStars+=1;const i=document.getElementById("star-count");i&&(i.textContent=this.collectedStars.toFixed(0))}t.removeItem(e)}this.character.waiting_effect[0]==""&&this.uicontroller.swapItem("none")}checkCollisionObstacles(t,e){for(let i of t.nearestObstacles)k(this.character,i)?(console.log("collide with obstacle "+i.name),this.character.condition=="robotic"?(this.audioManager.playBreakSound(),t.removeObstacle(i)):i.name.includes("bottom")?(this.audioManager.playBoundingSound(),this.character.vel.y=this.character.defaultMaxJumpVel):(i.colliding||(i.colliding=!0,i.collidedCnt++),i.collidedCnt>=i.collidedThreshold&&(this.audioManager.playBreakSound(),t.removeObstacle(i)),this.character.movement=="punching"&&(i.punchedTime+=e),i.punchedTime>1.5&&(this.audioManager.playBreakSound(),t.removeObstacle(i)))):i.colliding=!1}checkCollisonPhantom(){for(let t of this.stages)for(let e of t.nearestObstacles)if(k(this.character,e)&&e.name.includes("phantom")){const i={duration:3,apply:s=>{s.updateCondition("confusion"),this.character.rotate("y",Math.PI)},remove:s=>{s.updateCondition("normal"),this.character.rotate("y",Math.PI)}};this.character.applyEffect("confusion",i)}}checkSquash(){for(let t of this.stages)if(t.theme=="statues"){for(let e of t.nearestObstacles)if(!(!e.name.includes("dog")&&!e.name.includes("cat"))&&this.character.mesh.position.z>t.mesh.position.z+e.mesh.position.z-1.5&&this.character.mesh.position.z<t.mesh.position.z+e.mesh.position.z+1.5&&this.character.mesh.position.y<e.getBottomCenter().y&&this.character.mesh.position.y>e.getBottomCenter().y-2&&this.character.mesh.position.x>e.mesh.position.x-1.5&&this.character.mesh.position.x<e.mesh.position.x+1.5){const i={duration:3,apply:s=>{s.updateCondition("squashed")},remove:s=>{s.updateCondition("normal")}};this.audioManager.playSqueakSound(),this.character.applyEffect("squashed",i)}}}checkPositionState(){for(let t of this.stages)for(let e of t.specialIntervals)if(this.character.mesh.position.z>e[0]+t.mesh.position.z&&this.character.mesh.position.z<e[1]+t.mesh.position.z){if(e[2]=="wind_from_left"){const i={duration:.3,apply:r=>{r.force.x-=3},remove:r=>{r.force.x+=3}};this.character.applyEffect("windy",i);const s=new N,o=new n(this.character.mesh.position.x-5,this.character.mesh.position.y-5,this.character.mesh.position.z-5),a=new n(this.character.mesh.position.x+5,this.character.mesh.position.y+5,this.character.mesh.position.z+5);s.createWindEffect(o,a,50,.5,new n(-2,0,0)),this.scene.getScene().add(s.particles),s.addToUpdateList(this.scene.getScene())}if(e[2]=="wind_from_right"){const i={duration:.3,apply:r=>{r.force.x+=3},remove:r=>{r.force.x-=3}};this.character.applyEffect("windy",i);const s=new N,o=new n(this.character.mesh.position.x-5,this.character.mesh.position.y-5,this.character.mesh.position.z-5),a=new n(this.character.mesh.position.x+5,this.character.mesh.position.y+5,this.character.mesh.position.z+5);s.createWindEffect(o,a,50,.5,new n(2,0,0)),this.scene.getScene().add(s.particles),s.addToUpdateList(this.scene.getScene())}}}checkToChangeStage(){if(this.character.getBottomCenter().z+70>this.stages[this.stageidx].length+this.stages[this.stageidx].mesh.position.z&&this.changeStage(),this.character.getBottomCenter().z<this.stages[this.stageidx].mesh.position.z+5&&this.character.getBottomCenter().z>this.stages[this.stageidx].mesh.position.z){let t=this.stages[this.stageidx].theme;if(t=="normal")t="JellyGoRound";else if(t=="food")t="KrabRestaurant";else if(t=="vehicles")t="BoatingSchool";else if(t=="windy_food")t="Burger's Revenge";else if(t=="dungeon")t="Dungeon";else if(t=="statues")t="Rain Cats and Dogs";else if(t=="bikini_bottom")t="Bikini Bottom";else if(t=="final")t="Let's Rock";else{let e=Math.random();e>.7?t="THeRe y0U 2ee.mE...":e>.4?t="Thanks for your accompany.":t="You Are Not Supposed To Be Here."}this.uicontroller.showSentence(t,"title",1e3)}}updateFog(){this.directionLight.position.set(30,30,this.character.mesh.position.z+10)}checkToEnterSpecialStage(){if(this.character.mesh.position.z>2e3&&(this.enterSpecialStageLol=!0),this.character.mesh.position.z<this.enemyPos-5&&(this.enterSpecialStageLol=!0),this.character.mesh.position.z<-6&&(this.enterSpecialStageLol=!0),this.enterSpecialStageLol&&!this.alreadyEnteredSpecialStage){this.alreadyEnteredSpecialStage=!0,this.enemyMinVel=this.enemyMaxVel=0,this.enemyPos=-100,this.enemy.setPosition(0,0,this.enemyPos),this.enemy.destruct();for(let e of this.stages)this.scene.getScene().remove(e.mesh),e.destruct();this.stages=[];const t=new v(this.scene,"special",0,this.obstacleGenerator,this.itemGenerator,this.textureDict,"special");t.mesh.position.z=0,this.character.mesh.position.z=0,this.stages.push(t),this.stageidx=0}}tick(t){this.stages[this.stageidx].updateNearestList(this.character.mesh.position.clone(),20),this.stages[this.stageidx].tick(t),this.checkSquash(),this.checkPositionState(),this.checkCollisonPhantom(),this.checkCollisionObstacles(this.stages[this.stageidx],t),this.checkCollisionItems(this.stages[this.stageidx]),this.stageidx>0&&(this.stages[this.stageidx-1].tick(t),this.stages[this.stageidx-1].updateNearestList(this.character.mesh.position.clone(),20),this.checkCollisionObstacles(this.stages[this.stageidx-1],t),this.checkCollisionItems(this.stages[this.stageidx-1])),this.getCharactorMovableBoundary(),this.checkToChangeStage(),this.updateFog(),this.totalTime+=t;const e=document.getElementById("distance-value");e&&(e.textContent=this.character.mesh.position.z.toFixed(0)),this.enemy.tick(t);const i=this.enemyMinVel+(this.enemyMaxVel-this.enemyMinVel)*((this.character.mesh.position.z-this.enemyPos)/this.enemyDist);this.enemyPos+=i*t,this.enemyPos=Math.max(this.enemyPos,this.character.mesh.position.z-this.enemyDist),this.enemy.setPosition(0,0,this.enemyPos);const s=new p().setFromObject(this.enemy.mesh),o=Math.abs(this.character.mesh.position.z-s.max.z);o<2&&o>1.95&&this.audioManager.playWarningSound();const a=document.getElementById("distance-bar-fill"),r=document.getElementById("s-icon");if(a&&r){const h=this.enemyDist,c=Math.min(o/h,1);a.style.height=`${c*100}%`,r.style.bottom=`${c*100}%`;const d=Math.round(255*(1-c)),u=Math.round(255*c),A=`rgb(${d}, ${u}, 0)`;a.style.backgroundColor=A}k(this.character,this.enemy)&&!this.enterSpecialStageLol&&document.dispatchEvent(new CustomEvent("gameover",{detail:{obstacle:"killed by enemy"}})),this.checkToEnterSpecialStage()}}class Vt{constructor(){this.controllerListForLoop=[],this.gltfCharacterDict={},this.gltfObstacleDict={},this.gltfItemDict={},this.audioDict={},this.textureDict={},this.CharacterListForLoop=[],this.init()}async init(){this.status="paused",this.uiController=new vt,this.uiController.loadingScreen(),await yt(this.gltfCharacterDict,this.gltfObstacleDict,this.gltfItemDict,this.textureDict),this.audioManager=g.getInstance(),this.scene=new Mt,this.obstacleGenerator=new It(this.gltfObstacleDict),this.itemGenerator=new Et(this.gltfItemDict),this.initCharacter(),this.controller=new Ht(this.scene,this.Character,this.obstacleGenerator,this.itemGenerator,this.textureDict,this.uiController),this.camera=this.Character.camera,this.renderer=new Ct,this.loop=new xt(this.scene,this.camera,this.renderer),document.getElementById("scene-container").appendChild(this.renderer.domElement),this.cameraController=new Dt(this.camera,this.renderer.domElement),this.uiController.removeLoadingScreen(),await this.audioManager.loadAndPlayBGM(),this.reset(),this.start(),this.pause(),await this.uiController.countdown(5),this.uiController.showSentence("Go!","title",1e3),this.status="playing",this.resume(),this.registerEventHandlers()}reset(){this.Character.reset(),this.controller.init(),this.loop.updatableLists=[],this.CharacterListForLoop=[this.Character],this.controllerListForLoop=[this.controller],console.log("length of list for loop",this.controllerListForLoop.length),this.loop.updatableLists.push(this.CharacterListForLoop),this.loop.updatableLists.push(this.controllerListForLoop)}start(){this.loop.start()}pause(){const t=this.loop.updatableLists.indexOf(this.CharacterListForLoop);t!==-1&&this.loop.updatableLists.splice(t,1);const e=this.loop.updatableLists.indexOf(this.controllerListForLoop);e!==-1&&this.loop.updatableLists.splice(e,1),console.log("pausing ",this.loop.updatableLists)}resume(){this.loop.updatableLists.indexOf(this.CharacterListForLoop)===-1&&this.loop.updatableLists.push(this.CharacterListForLoop),this.loop.updatableLists.indexOf(this.controllerListForLoop)===-1&&this.loop.updatableLists.push(this.controllerListForLoop),console.log("resuming ",this.loop.updatableLists)}initCharacter(){if(localStorage.getItem("selectedCharacter")==="spongebob"){const e=new kt("spongeBob",this.gltfCharacterDict);e.rescale(1,1,1),this.Character=e,this.scene.getScene().add(this.Character.mesh),e.mesh.position.set(0,0,3)}else{const e=new Bt("patrick",this.gltfCharacterDict);e.rescale(1,1,1),this.Character=e,this.scene.getScene().add(this.Character.mesh),e.mesh.position.set(0,0,3)}}registerEventHandlers(){window.addEventListener("click",()=>{this.status==="paused"?(this.status="playing",this.resume(),this.uiController.resume()):this.status==="playing"&&(this.status="paused",this.pause(),this.uiController.pause())}),document.addEventListener("gameover",t=>{t instanceof CustomEvent&&(this.pause(),this.status="gameover",this.uiController.lose(),console.log("gameover",t.detail.obstacle))})}}function Nt(){const l=new Vt;window.game=l}Nt();
